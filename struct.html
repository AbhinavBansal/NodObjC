<!DOCTYPE html><html><head><title>Struct | NodObjC v0.0.10</title><link href="assets/styles.css" rel="stylesheet"><link href="assets/ir_black.css" rel="stylesheet"><script src="assets/jquery-1.7.1.js" type="text/javascript"></script><script src="assets/script.js" type="text/javascript"></script></head><body><div id="content"><a href="index.html" id="title"><h1>NodObjC</h1><h3>The NodeJS &#8646; Objective-C Bridge</h3></a><div class="toc"><span class="page"><a href="block.html">block</a></span><span class="page"><a href="bridgesupport.html">bridgesupport</a></span><span class="page"><a href="class.html">class</a></span><span class="page"><a href="core.html">core</a></span><span class="page"><a href="exception.html">exception</a></span><span class="page"><a href="ffi-extend.html">ffi-extend</a></span><span class="page"><a href="id.html">id</a></span><span class="page"><a href="imp.html">imp</a></span><span class="page"><a href="import.html">import</a></span><span class="page"><a href="index.html">index</a></span><span class="page"><a href="ivar.html">ivar</a></span><span class="page"><a href="method.html">method</a></span><span class="page"><a href="sel.html">sel</a></span><span class="page"><a href="struct.html">struct</a></span><span class="page"><a href="types.html">types</a></span></div><h2>Struct</h2><div class="part"><div class="desc"><p>Internal module that parses <em>"struct type encodings"</em> and turns them into proper node-ffi <code>Struct</code> instances.</p>
</div></div><div class="part"><h3>isStruct()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private function used internally by 
<code>NodObjC</code>. You should <b>not</b> need to use this function in
your code.
</div><p>Tests if the given arg is a <code>Struct</code> constructor or a string type encoding describing a struct (then true), otherwise false.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">isStruct</span> <span class="params">(type)</span> {</span>
  <span class="keyword">return</span> !!type.__isStructType__ || test.test(type)
}</code></pre></div><div class="part"><h3>getStruct()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private function used internally by 
<code>NodObjC</code>. You should <b>not</b> need to use this function in
your code.
</div><p>Returns the struct constructor function for the given struct name or type.</p>

<pre><code>{CGPoint="x"d"y"d}
</code></pre>
</div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">getStruct</span> <span class="params">(type)</span> {</span>
  <span class="comment">// First check if a regular name was passed in</span>
  <span class="keyword">var</span> rtn = structs[type];
  <span class="keyword">if</span> (rtn) <span class="keyword">return</span> rtn;
  <span class="comment">// If the struct type name has already been created, return that one</span>
  <span class="keyword">var</span> name = exports.parseStructName(type)
  <span class="comment">//console.error('name: %s', name)</span>
  rtn = structs[name];
  <span class="keyword">if</span> (rtn) {
    <span class="comment">//console.error('returning cached Struct')</span>
    <span class="keyword">return</span> rtn;
  }
  <span class="comment">// Next parse the type structure</span>
  <span class="keyword">var</span> parsed = exports.parseStruct(type);
  <span class="comment">// Otherwise we need to create a new Struct constructor</span>
  <span class="keyword">var</span> props = [];
  parsed.props.forEach(<span class="function"><span class="keyword">function</span> <span class="params">(prop)</span> {</span>
    props.push([ types.map(prop[<span class="number">1</span>]), prop[<span class="number">0</span>] ])
  })
  <span class="keyword">return</span> structs[parsed.name] = Struct(props)
}</code></pre></div><div class="part"><h3>parseStructName()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private function used internally by 
<code>NodObjC</code>. You should <b>not</b> need to use this function in
your code.
</div><p>Extracts only the name of the given struct type encoding string.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">parseStructName</span> <span class="params">(struct)</span> {</span>
  <span class="keyword">var</span> s = struct.substring(<span class="number">1</span>, struct.length-<span class="number">1</span>)
    , equalIndex = s.indexOf(<span class="string">'='</span>)
  <span class="keyword">if</span> (~equalIndex)
    s = s.substring(<span class="number">0</span>, equalIndex)
  <span class="keyword">return</span> s
}</code></pre></div><div class="part"><h3>parseStruct()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private function used internally by 
<code>NodObjC</code>. You should <b>not</b> need to use this function in
your code.
</div><p>Parses a struct type string into an Object with a <code>name</code> String and a <code>props</code> Array (entries are a type string, or another parsed struct object)</p>
</div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">parseStruct</span> <span class="params">(struct)</span> {</span>
  <span class="keyword">var</span> s = struct.substring(<span class="number">1</span>, struct.length-<span class="number">1</span>)
    , equalIndex = s.indexOf(<span class="string">'='</span>)
    , rtn = {
        name: s.substring(<span class="number">0</span>, equalIndex)
      , props: []
    }
  s = s.substring(equalIndex+<span class="number">1</span>)
  <span class="keyword">var</span> curProp = []
    , numBrackets = <span class="number">0</span>
    , entries = []
  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; s.length; i++) {
    <span class="keyword">var</span> cur = s[i]
    <span class="keyword">switch</span> (cur) {
      <span class="keyword">case</span> <span class="string">'&quot;'</span>:
        <span class="keyword">if</span> (numBrackets &gt; <span class="number">0</span>)
          curProp.push(cur)
        <span class="keyword">else</span>
          addProp()
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'{'</span>:
      <span class="keyword">case</span> <span class="string">'['</span>:
      <span class="keyword">case</span> <span class="string">'('</span>:
        numBrackets++
        curProp.push(cur)
        <span class="keyword">break</span>;
      <span class="keyword">case</span> <span class="string">'}'</span>:
      <span class="keyword">case</span> <span class="string">']'</span>:
      <span class="keyword">case</span> <span class="string">')'</span>:
        numBrackets--
        curProp.push(cur)
        <span class="keyword">break</span>;
      <span class="keyword">default</span>:
        curProp.push(cur)
        <span class="keyword">break</span>;
    }
  }
  addProp()
  <span class="function"><span class="keyword">function</span> <span class="title">addProp</span> <span class="params">()</span> {</span>
    entries.push(curProp.join(<span class="string">''</span>))
    curProp = []
    numBrackets = <span class="number">0</span>
  }
  <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">1</span>; i &lt; entries.length; i+=<span class="number">2</span>) {
    rtn.props.push([entries[i], entries[i+<span class="number">1</span>]])
  }
  <span class="keyword">return</span> rtn
}</code></pre></div></div><div id="footer">NodObjC &copy; 2011-2012 Nathan Rajlich. Documentation generated by 
<a href="https://github.com/visionmedia/dox">dox</a>.
</div><a href="http://github.com/TooTallNate/NodObjC"><img id="ribbon" src="https://a248.e.akamai.net/assets.github.com/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"></a></body></html>
