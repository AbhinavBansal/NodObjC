<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Import | NodObjC v0.0.8</title><link href="assets/styles.css" rel="stylesheet"/><link href="assets/ir_black.css" rel="stylesheet"/><script src="assets/jquery-1.7.1.js" type="text/javascript"></script><script src="assets/script.js" type="text/javascript"></script></head><body><div id="content"><a href="http://github.com/TooTallNate/NodObjC" id="title"><h1>NodObjC</h1><h3>The NodeJS &#8646; Objective-C Bridge</h3></a><h2>Import</h2><div class="part"><div class="desc"><p>Logic for importing a Framework into the node process.</p></div></div><div class="part"><div class="desc"><p>Accepts a single framework name and imports it into the current node process.<br /><code><span class="title">framework</span></code> may be a relative (singular) framework name, or a path (relative or<br />absolute) to a Framework directory.</p>

<pre><code><span class="variable">$.</span>NSObject   <span class="comment">// undefined</span>

<span class="variable">$.</span>import(<span class="string">'Foundation'</span>)

<span class="variable">$.</span>NSObject   <span class="comment">// [Class: NSObject]</span>
</code></pre></div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">importFramework</span> <span class="params">(framework, skip)</span> <span class="comment">{
  debug('importing framework:', framework, skip)
  framework = exports.resolve(framework)

  var shortName = basename(framework, SUFFIX)

  // Check if the framework has already been loaded
  var fw = cache[shortName]
  if (fw) {
    debug('skipping framework because already loaded:', framework)
    return
  }</span>

  // <span class="title">Load</span> <span class="title">the</span> <span class="title">main</span> <span class="title">framework</span> <span class="title">binary</span> <span class="title">file</span>
  <span class="title">var</span> <span class="title">frameworkPath</span> = <span class="title">join</span><span class="params">(framework, shortName)</span>
    , <span class="title">lib</span> = <span class="title">core</span>.<span class="title">dlopen</span><span class="params">(frameworkPath)</span>

  <span class="title">fw</span> = <span class="comment">{
      lib: lib
    , name: shortName
    , basePath: framework
    , binaryPath: frameworkPath
  }</span>

  // <span class="title">cache</span> <span class="title">before</span> <span class="title">loading</span> <span class="title">bridgesupport</span> <span class="title">files</span>
  <span class="title">cache</span>[<span class="title">shortName</span>] = <span class="title">fw</span>

  // <span class="title">Parse</span> <span class="title">the</span> <span class="title">BridgeSupport</span> <span class="title">file</span> <span class="title">and</span> <span class="title">inline</span> <span class="title">dylib</span>, <span class="title">for</span> <span class="title">the</span> <span class="title">C</span> <span class="title">functions</span>, <span class="title">enums</span>,
  // <span class="title">and</span> <span class="title">other</span> <span class="title">symbols</span> <span class="title">not</span> <span class="title">introspectable</span> <span class="title">at</span> <span class="title">runtime</span>.
  <span class="title">bridgesupport</span><span class="params">(fw)</span>

  // <span class="title">Iterate</span> <span class="title">through</span> <span class="title">the</span> <span class="title">loaded</span> <span class="title">classes</span> <span class="title">list</span> <span class="title">and</span> <span class="title">define</span> &amp;<span class="title">quot</span>;</span>setup getters&quot; <span class="keyword">for</span> them.
  <span class="keyword">if</span> (!skip) <span class="comment">{
    var classes = core.getClassList()
    debug('loading ObjC Classes:', classes.length)
    classes.forEach(function (c) {
      if (c in _global) return
      _global.__defineGetter__(c, function () {
        var clazz = _class.getClass(c)
        delete _global[c]
        return _global[c] = clazz
      }</span>)
    })
  }

  debug(<span class="string">'finished importing framework:'</span>, shortName)
}</code></pre></div><div class="part"><div class="desc"><p>Accepts a single framework name and resolves it into an absolute path<br />to the base directory of the framework.</p>

<p>In most cases, you will not need to use this function in your code.</p>

<pre><code>$.resolve(<span class="string">'Foundation'</span>)
<span class="comment">//  '/System/Library/Frameworks/Foundation.framework'</span>
</code></pre></div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> <span class="params">(framework)</span> {</span>
  <span class="comment">// already absolute, return as-is</span>
  <span class="keyword">if</span> (~framework.indexOf(<span class="string">'/'</span>)) <span class="keyword">return</span> framework;
  <span class="keyword">var</span> i = <span class="number">0</span>
    , l = exports.PATH.length
    , rtn = <span class="literal">null</span>
  <span class="keyword">for</span> (; i&lt;l; i++) {
    rtn = join(exports.PATH[i], framework + SUFFIX);
    <span class="keyword">if</span> (exists(rtn)) <span class="keyword">return</span> rtn;
  }
  <span class="keyword">throw</span> <span class="keyword">new</span> Error(<span class="string">'Could not resolve framework: '</span> + framework);
}</code></pre></div></div><div id="footer">NodObjC &copy; 2011-2012 Nathan Rajlich. Documentation generated by 
<a href="https://github.com/visionmedia/dox">dox</a>.
</div><a href="http://github.com/TooTallNate/NodObjC"><img id="ribbon" src="https://a248.e.akamai.net/assets.github.com/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"/></a></body></html>