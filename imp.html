<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head><title>Imp | NodObjC v0.0.8</title><link href="assets/styles.css" rel="stylesheet"/><link href="assets/ir_black.css" rel="stylesheet"/><script src="assets/jquery-1.7.1.js" type="text/javascript"></script><script src="assets/script.js" type="text/javascript"></script></head><body><div id="content"><a href="http://github.com/TooTallNate/NodObjC" id="title"><h1>NodObjC</h1><h3>The NodeJS &#8646; Objective-C Bridge</h3></a><h2>Imp</h2><div class="part"><div class="desc"><p>Represents a wrapped IMP. IMPs are function pointers for methods. The first<br />two arguments are always 1) the object instance the method is being called<br />on, and 2) the SEL selector, respectively. Subsequent arguments are the args<br />that were passed in when invoked.</p></div></div><div class="part"><div class="desc"><p>Module exports.</p></div><button class="show-code">Show Code</button><pre class="code"><code>exports.createWrapperPointer = createWrapperPointer
exports.createUnwrapperFunction = createUnwrapperFunction</code></pre></div><div class="part"><div class="desc"><p>Module dependencies.</p></div><button class="show-code">Show Code</button><pre class="code"><code><span class="keyword">var</span> core = require(<span class="string">'./core'</span>)
  , types = require(<span class="string">'./types'</span>)</code></pre></div><div class="part"><div class="desc"><p>Creates an ffi Function Pointer to the passed in 'func' Function. The<br />function gets wrapped in an "wrapper" function, which wraps the passed in<br />arguments, and unwraps the return value.</p></div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">createWrapperPointer</span> <span class="params">(func, type)</span> {</span>
  <span class="keyword">if</span> (func.pointer) {
    <span class="comment">// When an 'unwrapper' function is passed in, return the original pointer</span>
    <span class="keyword">return</span> func.pointer
  }
  <span class="keyword">var</span> rtnType = type.retval || type[<span class="number">0</span>] || <span class="string">'v'</span>
    , argTypes = type.args || type[<span class="number">1</span>] || []
    , ffiDef = [types.map(rtnType), types.mapArray(argTypes)]
    , ffiCb = <span class="keyword">new</span> core.Callback(ffiDef, wrapper)
  <span class="function"><span class="keyword">function</span> <span class="title">wrapper</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> args = core.wrapValues(arguments, argTypes)
      , rtn = func.apply(<span class="literal">null</span>, args)
    <span class="keyword">return</span> core.unwrapValue(rtn, rtnType)
  }
  <span class="keyword">return</span> ffiCb.getPointer()
}</code></pre></div><div class="part"><div class="desc"><p>Creates a JS Function from the passed in function pointer. When the returned<br />function is invoked, the passed in arguments are unwrapped before being<br />passed to the native function, and the return value is wrapped up before<br />being returned for real.</p></div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">createUnwrapperFunction</span> <span class="params">(funcPtr, type)</span> {</span>
  <span class="keyword">var</span> rtnType = type.retval || type[<span class="number">0</span>] || <span class="string">'v'</span>
    , argTypes = type.args || type[<span class="number">1</span>] || []
    , func = core.ForeignFunction.build(funcPtr
                                      , types.map(rtnType)
                                      , types.mapArray(argTypes))
  <span class="function"><span class="keyword">function</span> <span class="title">unwrapper</span> <span class="params">()</span> {</span>
    <span class="keyword">var</span> args = core.unwrapValues(arguments, argTypes)
      , rtn = func.apply(<span class="literal">null</span>, args)
    <span class="keyword">return</span> core.wrapValue(rtn, rtnType)
  }
  unwrapper.retval = rtnType
  unwrapper.args = argTypes
  unwrapper.pointer = funcPtr
  <span class="keyword">return</span> unwrapper
}</code></pre></div></div><div id="footer">NodObjC &copy; 2011-2012 Nathan Rajlich. Documentation generated by 
<a href="https://github.com/visionmedia/dox">dox</a>.
</div><a href="http://github.com/TooTallNate/NodObjC"><img id="ribbon" src="https://a248.e.akamai.net/assets.github.com/img/4c7dc970b89fd04b81c8e221ba88ff99a06c6b61/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub"/></a></body></html>