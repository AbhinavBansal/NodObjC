<!DOCTYPE html><html><head><title>Id | NodObjC v0.0.11</title><link href="assets/styles.css" rel="stylesheet"><link href="assets/ir_black.css" rel="stylesheet"><script src="assets/jquery-1.7.1.js" type="text/javascript"></script><script src="assets/script.js" type="text/javascript"></script></head><body><div id="content"><a href="index.html" id="title"><h1>NodObjC</h1><h3>The NodeJS &#8646; Objective-C Bridge</h3></a><div class="toc"><span class="page"><a href="block.html">block</a></span><span class="page"><a href="bridgesupport.html">bridgesupport</a></span><span class="page"><a href="class.html">class</a></span><span class="page"><a href="core.html">core</a></span><span class="page"><a href="exception.html">exception</a></span><span class="page"><a href="ffi-extend.html">ffi-extend</a></span><span class="page"><a href="id.html">id</a></span><span class="page"><a href="imp.html">imp</a></span><span class="page"><a href="import.html">import</a></span><span class="page"><a href="index.html">index</a></span><span class="page"><a href="ivar.html">ivar</a></span><span class="page"><a href="method.html">method</a></span><span class="page"><a href="sel.html">sel</a></span><span class="page"><a href="struct.html">struct</a></span><span class="page"><a href="types.html">types</a></span></div><h2>Id</h2><div class="part"><div class="desc"><p>The &#39;id&#39; function is essentially the &quot;base class&quot; for all Objective-C
objects that get passed around JS-land.</p>
</div></div><div class="part"><h3>wrap()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private function used internally by <code>NodObjC</code>. You should <b>not</b> need to use this function in
your code.</div><p>Wraps up a pointer that is expected to be a compatible Objective-C
object that can recieve messages. This function returns a cached version of the
wrapped function after the first time it is invoked on a given Pointer, using
Objective-C&#39;s internal association map for objects.
</p>
</div><button class="show-code">Show Code</button><pre class="code"><code><span class="function"><span class="keyword">function</span> <span class="title">wrap</span> <span class="params">(pointer)</span> {</span>
  debug(<span class="string">'id#wrap(%d)'</span>, pointer.address)
  <span class="keyword">var</span> rtn = <span class="literal">null</span>
    , p = core.objc_getAssociatedObject(pointer, KEY)
  <span class="keyword">if</span> (p.isNull()) {
    rtn = createFunctionWrapper(pointer)
    <span class="comment">// Store the wrapped instance internally</span>
    <span class="keyword">var</span> ref = <span class="keyword">new</span> core.Pointer(core.TYPE_SIZE_MAP.Object)
    <span class="comment">// don't call free() automatically when ref gets GC'd</span>
    <span class="comment">// TODO: we're gonna have to free this pointer someday!</span>
    <span class="comment">// XXX: use node-weak to get a callback when the wrapper is GC'd</span>
    ref.free = <span class="literal">false</span>
    ref.putObject(rtn)
    core.objc_setAssociatedObject(pointer, KEY, ref, <span class="number">0</span>)
  } <span class="keyword">else</span> {
    debug(<span class="string">'returning cached associated instance'</span>)
    rtn = p.getObject()
  }
  <span class="comment">//assert.equal(rtn.pointer.address, pointer.address)</span>
  <span class="keyword">return</span> rtn
}</code></pre></div><div class="part"><h3>Id#msgSend()</h3><div class="desc"><p>A very important function that <em>does the message sending</em> between
Objective-C objects. When you do <code>array(&#39;addObject&#39;, anObject)</code>, this
<code>msgSend</code> function is the one that finally gets called to do the dirty work.

</p>
<p>This function accepts a String selector as the first argument, and an Array
of (wrapped) values that get passed to the the message. This function takes
care of unwrapping the passed in arguments and wrapping up the result value,
if necessary.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.msgSend = <span class="function"><span class="keyword">function</span> <span class="title">msgSend</span> <span class="params">(sel, args)</span> {</span>
  debug(<span class="string">'sending message:'</span>, sel, args)
  <span class="keyword">var</span> types = <span class="keyword">this</span>._getTypes(sel, args)
    , argTypes = types[<span class="number">1</span>]
    , msgSendFunc = core.get_objc_msgSend(types)
    , unwrappedArgs = core.unwrapValues([<span class="keyword">this</span>, sel].concat(args), argTypes)
    , rtn
  <span class="keyword">try</span> {
    rtn = msgSendFunc.apply(<span class="literal">null</span>, unwrappedArgs)
  } <span class="keyword">catch</span> (e) {
    <span class="keyword">throw</span> exception.wrap(e)
  }
  <span class="comment">// Process the return value into a wrapped value if needed</span>
  <span class="keyword">return</span> core.wrapValue(rtn, types[<span class="number">0</span>])
}</code></pre></div><div class="part"><h3>Id#_getTypes()</h3><div class="desc"><div class="private"><div class="caution"></div>This is a private method used internally by <code>NodObjC</code>. You should <b>not</b> need to use this method in
your code.</div><p>Accepts a SEL and queries the current object for the return type and
argument types for the given selector. If current object does not implment
that selector, then check the superclass, and repeat recursively until
a subclass that responds to the selector is found, or until the base class
is found.

</p>
<p>TODO: Just merge this logic with <code>msgSend()</code>? It&#39;s not used anywhere else
</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto._getTypes = <span class="function"><span class="keyword">function</span> <span class="title">getTypes</span> <span class="params">(sel, args)</span> {</span>
  <span class="keyword">var</span> c = <span class="keyword">this</span>.getClass()
    , t = c._getTypesClass(sel, <span class="keyword">this</span>.isClass)
  <span class="keyword">if</span> (!t) {
    <span class="comment">// Unknown selector being send to object. This *may* still be valid, we</span>
    <span class="comment">// assume all args are type 'id' and return is 'id'.</span>
    debug(<span class="string">'unknown selector being sent:'</span>, sel)
    t = [ <span class="string">'@'</span>, [ <span class="string">'@'</span>, <span class="string">':'</span>, ].concat(args.map(<span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span> <span class="keyword">return</span> <span class="string">'@'</span> })) ]
  }
  <span class="keyword">return</span> t
}</code></pre></div><div class="part"><h3>Id#getClass()</h3><div class="desc"><p>Retrieves the wrapped Class instance for this object.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.getClass = <span class="function"><span class="keyword">function</span> <span class="title">getClass</span> <span class="params">()</span> {</span>
  <span class="keyword">return</span> Class.wrap(core.object_getClass(<span class="keyword">this</span>.pointer))
}</code></pre></div><div class="part"><h3>Id#getClassName()</h3><div class="desc"><p>Calls &#39;object_getClassName()&#39; on this object.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.getClassName = <span class="function"><span class="keyword">function</span> <span class="title">getClassName</span> <span class="params">()</span> {</span>
  <span class="keyword">return</span> core.object_getClassName(<span class="keyword">this</span>.pointer)
}</code></pre></div><div class="part"><h3>Id#setClass()</h3><div class="desc"><p>Dynamically changes the object&#39;s Class.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.setClass = <span class="function"><span class="keyword">function</span> <span class="title">setClass</span> <span class="params">(newClass)</span> {</span>
  <span class="keyword">return</span> Class.wrap(core.object_setClass(<span class="keyword">this</span>.pointer, newClass.pointer))
}</code></pre></div><div class="part"><h3>Id#ancestors()</h3><div class="desc"><p>Walks up the inheritance chain and returns an Array of Strings of
superclasses.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.ancestors = <span class="function"><span class="keyword">function</span> <span class="title">ancestors</span> <span class="params">()</span> {</span>
  <span class="keyword">var</span> rtn = []
    , c = <span class="keyword">this</span>.getClass()
  <span class="keyword">while</span> (c) {
    rtn.push(c.getName())
    c = c.getSuperclass()
  }
  <span class="keyword">return</span> rtn
}</code></pre></div><div class="part"><h3>Id#ivar()</h3><div class="desc"><p>Getter/setter function for instance variables (ivars) of the object,
If just a name is passed in, then this function gets the ivar current value.
If a name and a new value are passed in, then this function sets the ivar.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.ivar = <span class="function"><span class="keyword">function</span> <span class="title">ivar</span> <span class="params">(name, value)</span> {</span>
  <span class="comment">// TODO: Add support for passing in a wrapped Ivar instance as the `name`</span>
  <span class="keyword">if</span> (arguments.length > <span class="number">1</span>) {
    <span class="comment">// setter</span>
    debug(<span class="string">'setting ivar:'</span>, name, value)
    <span class="keyword">var</span> ivar = <span class="keyword">this</span>.isClass
             ? <span class="keyword">this</span>.getClassVariable(name)
             : <span class="keyword">this</span>.getClass().getInstanceVariable(name)
      , unwrapped = core.unwrapValue(value, ivar.getTypeEncoding())
    <span class="keyword">return</span> core.object_setIvar(<span class="keyword">this</span>.pointer, ivar.pointer, unwrapped)
  } <span class="keyword">else</span> {
    <span class="comment">// getter</span>
    debug(<span class="string">'getting ivar:'</span>, name)
    <span class="keyword">var</span> ptr = <span class="keyword">new</span> core.Pointer(core.TYPE_SIZE_MAP.pointer)
      , ivar = core.object_getInstanceVariable(<span class="keyword">this</span>.pointer, name, ptr)
    <span class="keyword">return</span> core.wrapValue(ptr.getPointer(), core.ivar_getTypeEncoding(ivar))
  }
}</code></pre></div><div class="part"><h3>Id#ivars()</h3><div class="desc"><p>Returns an Array of Strings of the names of the ivars that the current object
contains. This function can iterate through the object&#39;s superclasses
recursively, if you specify a &#39;maxDepth&#39; argument.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.ivars = <span class="function"><span class="keyword">function</span> <span class="title">ivars</span> <span class="params">(maxDepth, sort)</span> {</span>
  <span class="keyword">var</span> rtn = []
    , c = <span class="keyword">this</span>.getClass()
    , md = maxDepth || <span class="number">1</span>
    , depth = <span class="number">0</span>
  <span class="keyword">while</span> (c &amp;&amp; depth++ &lt; md) {
    <span class="keyword">var</span> is = c.getInstanceVariables()
      , i = is.length
    <span class="keyword">while</span> (i--) {
      <span class="keyword">if</span> (!~rtn.indexOf(is[i])) rtn.push(is[i])
    }
    c = c.getSuperclass()
  }
  <span class="keyword">return</span> sort === <span class="literal">false</span> ? rtn : rtn.sort()
}</code></pre></div><div class="part"><h3>Id#methods()</h3><div class="desc"><p>Returns an Array of Strings of the names of methods that the current object
will respond to. This function can iterate through the object&#39;s superclasses
recursively, if you specify a &#39;maxDepth&#39; number argument.</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.methods = <span class="function"><span class="keyword">function</span> <span class="title">methods</span> <span class="params">(maxDepth, sort)</span> {</span>
  <span class="keyword">var</span> rtn = []
    , c = <span class="keyword">this</span>.getClass()
    , md = maxDepth || <span class="number">1</span>
    , depth = <span class="number">0</span>
  <span class="keyword">while</span> (c &amp;&amp; depth++ &lt; md) {
    <span class="keyword">var</span> ms = c.getInstanceMethods()
      , i = ms.length
    <span class="keyword">while</span> (i--) {
      <span class="keyword">if</span> (!~rtn.indexOf(ms[i])) rtn.push(ms[i])
    }
    c = c.getSuperclass()
  }
  <span class="keyword">return</span> sort === <span class="literal">false</span> ? rtn : rtn.sort()
}</code></pre></div><div class="part"><h3>Id#ref()</h3><div class="desc"><p>Returns a <strong>node-ffi</strong> pointer pointing to this object. This is a convenience
function for methods that take pointers to objects (i.e. <code>NSError**</code>).
</p>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.ref = <span class="function"><span class="keyword">function</span> <span class="title">ref</span> <span class="params">()</span> {</span>
  debug(<span class="string">'id#ref()'</span>)
  <span class="keyword">var</span> ptr = <span class="keyword">this</span>.pointer.ref()
  <span class="keyword">return</span> ptr
}</code></pre></div><div class="part"><h3>Id#toString()</h3><div class="desc"><p>The overidden <code>toString()</code> function proxies up to the real Objective-C object&#39;s
<code>description</code> method. In Objective-C, this is equivalent to:

</p>
<pre><code>[[id description] UTF8String]</code></pre>
</div><button class="show-code">Show Code</button><pre class="code"><code>proto.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span> <span class="params">()</span> {</span>
  <span class="keyword">return</span> <span class="keyword">this</span>(<span class="string">'description'</span>)(<span class="string">'UTF8String'</span>)
}</code></pre></div></div><div id="footer">NodObjC &copy; 2011-2012 Nathan Rajlich. Documentation generated by <a href="https://github.com/visionmedia/dox">dox</a>.</div><a href="http://github.com/TooTallNate/NodObjC"><img id="ribbon" src="https://a248.e.akamai.net/camo.github.com/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a></body></html>
